/**
 * grrd's Puzzle
 * Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";var e,t,n,o,a,s,i,r,l,g,c,d,m,A,u,h,f,b,v,y,I,w,_,p,P,E,k,L=!!window.HTMLCanvasElement,S=new Kinetic.Layer({name:"g_layer"}),D=new Kinetic.Layer({name:"g_back_g_layer"}),B=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),T=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),R=!1,x=0,Q=0,M=!1,C=2,F=new Image,Y="",X=4,z=6,G=15,H=0,N=!1,K=!1,O=!1,q=!0,U=!0,j=!0,W=!0,Z=!1,V=!0,J=!0,$=!1,ee=function(e){return document.getElementById(e)},te=ee("select_theme_img"),ne=ee("b_back_g_grid"),oe=ee("b_back_g_image"),ae=ee("b_rotate"),se=ee("b_sound"),ie=ee("container"),re=ee("b_gold"),le=ee("b_gold_enabled"),ge=ee("b_gold_disabled"),ce=ee("b_prev"),de=ee("b_next"),me=ee("bt_easy"),Ae=ee("bt_med"),ue=ee("bt_hard"),he=ee("bt_close"),fe=ee("b_image_input"),be=ee("iPopupInfo"),ve=ee("iPopupSettings"),ye=ee("iFullscreen"),Ie=ee("iPopupHelp"),we=ee("img_help"),_e=ee("lb_help"),pe=ee("game"),Pe=ee("title"),Ee=function(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function ke(e){e.classList.remove("popup-init"),e.classList.remove("popup-hide"),e.classList.add("popup-show")}function Le(e){e.classList.remove("popup-show"),e.classList.add("popup-hide"),setTimeout((function(){e.scrollTop=0}),1050)}function Se(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?ee("img_fullscreen").src="Images/escfullscreen.svg":ee("img_fullscreen").src="Images/fullscreen.svg"}"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("sw.js").then((function(e){}),(function(e){}))}));const De=new Promise((e,t)=>{const n=new Image;n.onload=()=>{e(1===n.naturalWidth)},n.onerror=t,n.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z"});function Be(){K=!0,N=!1}function Te(){var e;Le(Ie),setTimeout((function(){ee("iCloseHelp").classList.remove("dn"),we.style.height=null,we.style.padding=null}),500),Pe.classList.remove("swipe-out-right"),pe.classList.remove("swipe-in-left"),Pe.classList.add("swipe-out"),pe.classList.add("swipe-in"),setTimeout((function(){var t=S.getChildren();for(e=0;e<t.length;e+=1)t[e].setZIndex(Math.floor(Math.random()*z*X));for(e=0;e<t.length;e+=1)O?new Kinetic.Tween({node:t[e],x:Math.floor(Math.random()*P*(z-1))+P/2,y:Math.floor(Math.random()*E*(X-1))+E/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:Be()}).play():new Kinetic.Tween({node:t[e],x:Math.floor(Math.random()*P*(z-1))+P/2,y:Math.floor(Math.random()*E*(X-1))+E/2,duration:1,onFinish:Be()}).play()}),2e3)}function Re(e,t,n,o){!function(){var a;if(q){var s=new Kinetic.Shape({drawFunc:function(o){o.beginPath(),o.moveTo(_,p),0===t?o.lineTo(_+P,p):(o.bezierCurveTo(_+.8*P,p+.1*E*n,_,p-.25*E*n,_+P/2,p-.25*E*n),o.bezierCurveTo(_+P,p-.25*E*n,_+.2*P,p+.1*E*n,_+P,p)),e===z-1?o.lineTo(_+P,p+E):(o.bezierCurveTo(_+P+.1*P*n,p+.8*E,_+P-.25*P*n,p,_+P-.25*P*n,p+E/2),o.bezierCurveTo(_+P-.25*P*n,p+E,_+P+.1*P*n,p+.2*E,_+P,p+E)),t===X-1?o.lineTo(_,p+E):(o.bezierCurveTo(_+.2*P,p+E-.1*E*n,_+P,p+E+.25*E*n,_+P/2,p+E+.25*E*n),o.bezierCurveTo(_,p+E+.25*E*n,_+.8*P,p+E-.1*E*n,_,p+E)),0===e?o.lineTo(_,p):(o.bezierCurveTo(_-.1*P*n,p+.2*E,_+.25*P*n,p+E,_+.25*P*n,p+E/2),o.bezierCurveTo(_+.25*P*n,p,_-.1*P*n,p+.8*E,_,p)),o.closePath(),o.fillStrokeShape(this)},fillPatternImage:o,fillPatternOffset:[e*P,t*E],stroke:"black",strokeWidth:4});s.toImage({width:P+.6*P,height:E+.6*E,x:.3*-P,y:.3*-E,callback:function(n){He(a=new Kinetic.Image({image:n,x:e*P+P/2,origX:e*P+P/2,y:t*E+E/2,origY:t*E+E/2,row:t,col:e,offset:[P/2+.3*P,E/2+.3*E],draggable:!0,dragBoundFunc:function(e){var t=e.y,n=e.x;return n<0&&(n=0),n>c&&(n=c),t<0&&(t=0),t>d&&(t=d),{x:n,y:t}},name:"part_z"+t+"_s"+e})),a.createImageHitRegion((function(){S.drawHit()}))}}),s.setStrokeWidth(null),s.setStroke(null),s.toImage({width:P+.6*P,height:E+.6*E,x:.3*-P,y:.3*-E,callback:function(n){v[t][e]=n}})}else He(a=new Kinetic.Image({x:e*P+P/2,origX:e*P+P/2,y:t*E+E/2,origY:t*E+E/2,row:t,col:e,width:P,height:E,offset:[P/2,E/2],crop:{x:o.width/z*e,y:o.height/X*t,width:o.width/z,height:o.height/X},stroke:"black",strokeWidth:4,fill:"black",Image:o,draggable:!0,dragBoundFunc:function(e){var t=e.y,n=e.x;return n<0&&(n=0),n>c&&(n=c),t<0&&(t=0),t>d&&(t=d),{x:n,y:t}},name:"part_z"+t+"_s"+e}))}()}function xe(){var e,t;for(v=[],e=0;e<X;e+=1)v[e]=[];H=0,S.removeChildren(),D.removeChildren(),B.removeChildren(),B.setWidth(c),B.setHeight(d),_=0,p=0,P=c/z,E=d/X,1,B.add(S);var n=c,o=d;T&&(o/=function(e,t){var n=document.createElement("canvas");n.width=1,n.height=t;var o=n.getContext("2d");o.drawImage(e,0,0);for(var a=o.getImageData(0,0,1,t).data,s=0,i=t,r=t;r>s;)0===a[4*(r-1)+3]?i=r:s=r,r=i+s>>1;var l=r/t;return 0===l?1:l}(F,F.naturalHeight));0!==k.getPos()||5!==r&&6!==r&&7!==r&&8!==r||(n=d,o=c);var a=new Kinetic.Image({width:n,height:o,crop:{x:0,y:0,width:F.width,height:F.height},Image:F});0!==k.getPos()||5!==r&&6!==r||(a.setRotationDeg(90),a.setX(c)),0!==k.getPos()||3!==r&&4!==r||(a.setRotationDeg(180),a.setX(c),a.setY(d)),0!==k.getPos()||7!==r&&8!==r||(a.setRotationDeg(270),a.setY(d)),a.toImage({width:c,height:d,callback:function(n){if((U||j)&&function(e){var t,n,o,a;if(j&&(t=new Kinetic.Image({x:0,y:0,width:c,height:d,Image:e,opacity:.1}),D.add(t),D.draw()),U)for(n=0;n<X;n+=1)for(o=0;o<z;o+=1)a=new Kinetic.Rect({x:o*P,y:n*E,width:P,height:E,stroke:"#333333",strokeWidth:2}),D.add(a);B.add(D),D.moveToBottom()}(n),q)a.toImage({width:c,height:d,callback:function(n){for(t=0;t<X;t+=1)for(e=0;e<z;e+=1)Re(e,t,t%2!=0&&e%2!=0||t%2==0&&e%2==0?1:-1,n);S.draw(),Te()}});else{for(t=0;t<X;t+=1)for(e=0;e<z;e+=1)Re(e,t,t%2!=0&&e%2!=0||t%2==0&&e%2==0?1:-1,n);S.draw(),Te()}}})}function Qe(){if(I=k.getPos(),y=parseInt(ee("nav"+I).getElementsByClassName("selected")[0].getAttribute("data-num"),10),!N)return void 0===y||void 0===a&&0===I?(we.src="Images/photo.svg",_e.innerHTML=document.webL10n.get("lb_choose"),void ke(Ie)):void(I>0&&V&&ee("image"+I+"-"+y).classList.contains("locked")||(N=!0,we.src="Images/loading.svg",we.style.height="70px",we.style.padding="5px",_e.innerHTML=document.webL10n.get("lb_load"),ee("iCloseHelp").classList.add("dn"),ke(Ie),U=ne.checked,j=oe.checked,O=ae.checked,W=se.checked,Ee&&(localStorage.setItem("s_back_g_grid",ne.checked?"on":"off"),localStorage.setItem("s_backg_image",oe.checked?"on":"off"),localStorage.setItem("s_rotate",ae.checked?"on":"off"),localStorage.setItem("s_sound",se.checked?"on":"off")),document.getElementById("container").width=l,document.getElementById("container").height=g,d=g,c=l,A=Y,0!==I?(i=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,s=Math.min(g,l)*i<=270?"s":Math.min(g,l)*i>1080?"l":"",o="Images/"+t+"/image-set-"+I+"/sujet"+Y+y+s+".jpg"):o=a,F.addEventListener("load",xe),F.src=o))}function Me(e,t,n,o){var a,s,i,r,l,g,m;if("g_layer"===e.getParent().attrs.name)if("g_layer"===t.getParent().attrs.name){t.setX(n),t.setY(o);var A=new Kinetic.Group({draggable:!0,dragBoundFunc:function(e){var t=e.y,n=e.x;return n<0&&(n=0),n>c&&(n=c),t<0&&(t=0),t>d&&(t=d),{x:n,y:t}}});e.moveTo(A),t.moveTo(A),e.setDraggable(!1),t.setDraggable(!1),S.add(A)}else r=e.getX(),l=e.getY(),t.getParent().setX(t.getParent().getX()+n-t.getAbsolutePosition().x),t.getParent().setY(t.getParent().getY()+o-t.getAbsolutePosition().y),e.moveTo(t.getParent()),e.setRotationDeg(t.getRotationDeg()),g=r-e.getAbsolutePosition().x,m=l-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&(e.setX(e.getX()+g),e.setY(e.getY()+m)),90===e.getParent().getRotationDeg()&&(e.setY(e.getY()-g),e.setX(e.getX()+m)),180===e.getParent().getRotationDeg()&&(e.setX(e.getX()-g),e.setY(e.getY()-m)),270===e.getParent().getRotationDeg()&&(e.setY(e.getY()+g),e.setX(e.getX()-m)),e.setDraggable(!1);else if("g_layer"===t.getParent().attrs.name)t.moveTo(e.getParent()),t.setAbsolutePosition(n,o),t.setRotationDeg(e.getRotationDeg()),t.setDraggable(!1);else{s=t.getParent().getChildren();for(var u=n-t.getAbsolutePosition().x,h=o-t.getAbsolutePosition().y;s.length>0;)void 0!==s[0]&&(r=(i=s[0]).getAbsolutePosition().x,l=i.getAbsolutePosition().y,i.moveTo(e.getParent()),i.setRotationDeg(e.getRotationDeg()),g=r-i.getAbsolutePosition().x+u,m=l-i.getAbsolutePosition().y+h,0===e.getParent().getRotationDeg()&&(i.setX(i.getX()+g),i.setY(i.getY()+m)),90===e.getParent().getRotationDeg()&&(i.setY(i.getY()-g),i.setX(i.getX()+m)),180===e.getParent().getRotationDeg()&&(i.setX(i.getX()-g),i.setY(i.getY()-m)),270===e.getParent().getRotationDeg()&&(i.setY(i.getY()+g),i.setX(i.getX()-m)))}var f=(s=e.getParent().getChildren())[0].getAbsolutePosition().x,b=s[0].getAbsolutePosition().x,v=s[0].getAbsolutePosition().y,y=s[0].getAbsolutePosition().y;for(a=0;a<s.length;a+=1)s[a].getAbsolutePosition().x<f&&(f=s[a].getAbsolutePosition().x),s[a].getAbsolutePosition().x>b&&(b=s[a].getAbsolutePosition().x),s[a].getAbsolutePosition().y<v&&(v=s[a].getAbsolutePosition().y),s[a].getAbsolutePosition().y>y&&(y=s[a].getAbsolutePosition().y);r=e.getAbsolutePosition().x,l=e.getAbsolutePosition().y,e.getParent().setOffset(0,0),e.getParent().setX((f+b)/2),e.getParent().setY((v+y)/2),g=r-e.getAbsolutePosition().x,m=l-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*g,-1*m),90===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*m,g),180===e.getParent().getRotationDeg()&&e.getParent().setOffset(g,m),270===e.getParent().getRotationDeg()&&e.getParent().setOffset(m,-1*g),"g_layer"===t.getParent().attrs.name?t.moveToTop():t.getParent().moveToTop(),S.draw(),W&&document.getElementById("click_sound").play()}function Ce(e){var t,n,o,a,s=[-1,1,0,0],i=[0,0,-1,1];for(h="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,t=0;t<s.length;t+=1)(a=B.get(".part_z"+(e.attrs.row+i[t])+"_s"+(e.attrs.col+s[t]))).length>0&&(f="g_layer"===a[0].getParent().attrs.name?a[0].getRotationDeg():(a[0].getRotationDeg()+a[0].getParent().getRotationDeg())%360,0===h&&(n=e.getAbsolutePosition().x+P*s[t],o=e.getAbsolutePosition().y+E*i[t]),90===h&&(n=e.getAbsolutePosition().x-E*i[t],o=e.getAbsolutePosition().y+P*s[t]),180===h&&(n=e.getAbsolutePosition().x-P*s[t],o=e.getAbsolutePosition().y-E*i[t]),270===h&&(n=e.getAbsolutePosition().x+E*i[t],o=e.getAbsolutePosition().y-P*s[t]),Math.abs(n-a[0].getAbsolutePosition().x)<G&&Math.abs(o-a[0].getAbsolutePosition().y)<G&&h===f&&("g_layer"===e.getParent().attrs.name||"g_layer"===a[0].getParent().attrs.name||e.getParent()!==a[0].getParent())&&Me(e,a[0],n,o))}function Fe(e){void 0!==e&&(e.setX(e.attrs.origX),e.setY(e.attrs.origY),e.setRotationDeg(0),e.moveToBottom(),e.setStrokeWidth(null),e.setStroke(null),e.setDraggable(!1),q&&e.setImage(v[e.attrs.row][e.attrs.col]),S.draw(),q&&e.disableShadow(),W&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout((function(){(H+=1)===z*X&&(he.classList.add("dn"),W&&document.getElementById("ding_sound").play())}),500))}function Ye(){Ee&&localStorage.setItem("s_gold",re.checked?"on":"off"),!0===re.checked?(Z=!0,ee("img_easy").src="Images/easy_gold.svg",ee("img_med").src="Images/medium_gold.svg",ee("img_hard").src="Images/hard_gold.svg"):(Z=!1,ee("img_easy").src="Images/easy.svg",ee("img_med").src="Images/medium.svg",ee("img_hard").src="Images/hard.svg")}function Xe(){var e,n,o,a,s=0;for(e=1;e<5;e+=1)for(n=1;n<4;n+=1)o=Ee&&localStorage.getItem(t+e+Y+n)||0,s+=parseInt(o),V?o>0?((a=ee("medal"+e+"-"+n)).classList.remove("dn"),a.src="Images/medal"+o+".svg",n<3&&(ee("image"+e+"-"+(n+1)).classList.remove("locked"),ee("lock"+e+"-"+(n+1)).classList.add("dn"))):(ee("medal"+e+"-"+n).classList.add("dn"),n<3&&(ee("image"+e+"-"+(n+1)).classList.add("locked"),ee("lock"+e+"-"+(n+1)).classList.remove("dn"))):(ee("medal"+e+"-"+n).classList.add("dn"),ee("image"+e+"-"+(n+1)).classList.remove("locked"),ee("lock"+e+"-"+(n+1)).classList.add("dn"));36===s?(le.style.display="block",re.checked=!0,Ye(),ge.style.display="none"):(ge.style.display="block",re.checked=!1,Ye(),le.style.display="none")}function ze(){var e,o;if(g=document.documentElement.clientHeight,l=document.documentElement.clientWidth,Y="",g>l&&(Y="p"),navigator.onLine){for(e=1;e<C+1;e+=1)for(o=1;o<4;o+=1)ee("image"+e+"-"+o).src="Images/"+t+"/image-set-"+e+"/sujet"+Y+o+"s.jpg";for(let e of document.querySelectorAll(".offline"))e.style.display="none";for(let e of document.querySelectorAll(".online"))e.style.display="block"}else{for(let e of document.querySelectorAll(".offline"))e.style.display="block";for(let e of document.querySelectorAll(".online"))e.style.display="none";k.slide(0,0)}t===n&&Y===m||(n=t,m=Y,Xe())}function Ge(e){var n;he.classList.remove("dn"),e&&(n=Ee&&localStorage.getItem(t+I+A+y)||0,parseInt(w)>parseInt(n)&&(Ee&&localStorage.setItem(t+I+A+y,w),Xe(),W&&document.getElementById("ding_sound").play())),Pe.classList.remove("swipe-out"),pe.classList.remove("swipe-in"),Pe.classList.add("swipe-out-right"),pe.classList.add("swipe-in-left"),ze(),setTimeout((function(){ze()}),500)}function He(e){var t;e.on("mouseover",(function(){(e.getDraggable()||e.getParent().getDraggable())&&K&&(document.body.style.cursor="pointer")})),e.on("click tap",(function(){!1!==$&&((e.getDraggable()||e.getParent().getDraggable())&&K&&O&&u===S.getChildren().length-1?"g_layer"===e.getParent().attrs.name?(t=e.getRotation(),K=!1,new Kinetic.Tween({node:e,duration:.5,rotation:t+Math.PI/2,onFinish:function(){K=!0,360===e.getRotationDeg()&&e.setRotationDeg(0),e.fire("dragend")}}).play()):(t=e.getParent().getRotation(),K=!1,new Kinetic.Tween({node:e.getParent(),duration:.5,rotation:t+Math.PI/2,onFinish:function(){K=!0,360===e.getParent().getRotationDeg()&&e.getParent().setRotationDeg(0),e.fire("dragend")}}).play()):H===z*X?(K=!1,Ge(!0)):e.fire("dragend"))})),e.on("mousedown touchstart",(function(){$=!0,setTimeout((function(){$=!1}),500),b=e,(e.getDraggable()||e.getParent().getDraggable())&&K&&("g_layer"===e.getParent().attrs.name?(u=e.getZIndex(),e.moveToTop()):(u=e.getParent().getZIndex(),e.getParent().moveToTop()))})),e.on("dragend",(function(){(e.getDraggable()||e.getParent().getDraggable())&&K?function(e){var t,n,o;if(h="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,Math.abs(e.getAbsolutePosition().x-e.attrs.origX)<G&&Math.abs(e.getAbsolutePosition().y-e.attrs.origY)<G&&0===h)if("g_layer"===e.getParent().attrs.name)Fe(e);else for(n=e.getParent().getChildren();n.length>0;)(o=n[0]).moveTo(S),Fe(o);else if("g_layer"===e.getParent().attrs.name)Ce(e);else for(n=e.getParent().getChildren(),t=0;t<n.length;t+=1)Ce(n[t])}(e):H===z*X&&(K=!1,Ge(!0))})),e.on("mouseout",(function(){document.body.style.cursor="default"})),S.add(e),S.draw(),B.draw()}function Ne(e){var t;if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return we.src="Images/photo.svg",_e.innerHTML=document.webL10n.get("lb_own_img"),void ke(Ie);if((t=e.target.files[0]).type.match("image.*")){var n=new FileReader;n.onload=function(t){r=0,a=t.target.result,EXIF.getData(e.target.files[0],(function(){De||(r=EXIF.getTag(this,"Orientation"))})),ee("image0-1").src=a,ee("imageOff").src=a,ze(),setTimeout((function(){ze()}),500)},n.readAsDataURL(t)}}function Ke(e){t=e,te.src="Images/"+t+"/theme.png",R&&(ee("select_theme").innerHTML=document.webL10n.get("lb_"+t)),Ee&&localStorage.setItem("s_theme",e),ze()}function Oe(){0===k.getPos()?ee("bullets0").src="Images/bullets1o.svg":ee("bullets0").src="Images/bullets0o.svg",1===k.getPos()?ee("bullets1").src="Images/bullets1.svg":ee("bullets1").src="Images/bullets0.svg",2===k.getPos()?ee("bullets2").src="Images/bullets1.svg":ee("bullets2").src="Images/bullets0.svg",3===k.getPos()?ee("bullets3").src="Images/bullets1.svg":ee("bullets3").src="Images/bullets0.svg",4===k.getPos()?ee("bullets4").src="Images/bullets1.svg":ee("bullets4").src="Images/bullets0.svg"}function qe(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}var Ue,je,We,Ze;ie.addEventListener("mouseup",(function(){void 0!==b&&"g_layer"!==b.getParent().attrs.name&&setTimeout((function(){b.fire("dragend")}),350)}),!1),ie.addEventListener("touchend",(function(){void 0!==b&&"g_layer"!==b.getParent().attrs.name&&setTimeout((function(){b.fire("dragend")}),350)}),!1),Array.from(document.getElementsByClassName("own-nav")).forEach((function(e){e.addEventListener("click",(function(){if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return we.src="Images/photo.svg",_e.innerHTML=document.webL10n.get("lb_own_img"),void ke(Ie);"file"!==fe.type?window.MozActivity&&(new MozActivity({name:"pick",data:{type:"image/jpeg"}}).onsuccess=function(){a=window.URL.createObjectURL(this.result.blob),ee("image0-1").src=a,ee("imageOff").src=a,ze(),setTimeout((function(){ze()}),500)}):fe.click()}))})),window.onload=function(){J&&(J=!1,ee("iInfo").addEventListener("click",(function(){ke(be)})),ee("iInfoClose").addEventListener("click",(function(){Le(be)})),ee("iSettings").addEventListener("click",(function(){M||(M=!0,ee("t_europe").src="Images/europe/theme.png",ee("t_africa").src="Images/africa/theme.png",ee("t_asia").src="Images/asia/theme.png",ee("t_america").src="Images/america/theme.png",ee("t_animals").src="Images/animals/theme.png",ee("t_flowers").src="Images/flowers/theme.png",ee("t_tricky").src="Images/tricky/theme.png",ee("t_mascha").src="Images/mascha/theme.png",ee("t_mascha2").src="Images/mascha2/theme.png",ee("t_mascha3").src="Images/mascha3/theme.png",ee("t_shrek").src="Images/shrek/theme.png"),ke(ve)})),ee("iSettingsClose").addEventListener("click",(function(){Le(ve)})),ye.addEventListener("click",(function(){var e,t,n,o;e=window.document,t=e.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,o=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen,e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?o.call(e):n.call(t)})),(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!0===navigator.standalone||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&ye.parentNode.removeChild(ye),ee("iCloseHelp").addEventListener("click",(function(){Le(Ie)})),Ie.addEventListener("click",(function(){ee("iCloseHelp").classList.contains("dn")||Le(Ie)})),ee("bt_theme").addEventListener("click",(function(){document.getElementsByClassName("dropdown")[0].classList.toggle("show"),document.getElementsByClassName("icon")[0].classList.toggle("rotate")})),re.addEventListener("change",e=>{Ye()}),k=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(e,t){ee("bullets0").src=0===t?"Images/bullets1o.svg":"Images/bullets0o.svg",1===t?ee("bullets1").src="Images/bullets1.svg":(ee("bullets1").src="Images/bullets0.svg",C=4,ze()),ee("bullets2").src=2===t?"Images/bullets1.svg":"Images/bullets0.svg",ee("bullets3").src=3===t?"Images/bullets1.svg":"Images/bullets0.svg",ee("bullets4").src=4===t?"Images/bullets1.svg":"Images/bullets0.svg"}}),document.getElementById("b_image_input").addEventListener("change",Ne,!1),Array.from(document.getElementsByClassName("list-button-33-sel")).forEach((function(e){e.addEventListener("click",(function(){event,Array.from(event.target.parentNode.getElementsByClassName("list-button-33-sel")).forEach((function(e){e.classList.remove("selected")})),event.target.classList.add("selected")}))})),ce.addEventListener("click",(function(e){k.prev(),Oe(),e.preventDefault()})),de.addEventListener("click",(function(e){k.next(),Oe(),e.preventDefault()})),me.addEventListener("click",(function(){w="1",g>l?Z?(X=9,z=6):(X=3,z=2):Z?(X=6,z=9):(X=2,z=3),Qe()})),Ae.addEventListener("click",(function(){w="2",g>l?Z?(X=12,z=8):(X=6,z=4):Z?(X=8,z=12):(X=4,z=6),Qe()})),ue.addEventListener("click",(function(){w="3",g>l?Z?(X=18,z=12):(X=8,z=5):Z?(X=12,z=18):(X=5,z=8),Qe()})),he.addEventListener("click",(function(){K=!1,Ge(!1)})),ee("s_mascha").addEventListener("click",(function(){(x+=1)>2&&(Array.from(document.getElementsByClassName("t_mascha")).forEach((function(e){e.classList.remove("dn")})),Ee&&localStorage.setItem("s_mascha","true"))})),ee("s_grrd").addEventListener("click",(function(){(Q+=1)>5&&(ee("t_shrek").parentNode.classList.remove("dn"),ee("favicon").href="Images/favicon_dark.ico",Ee&&localStorage.setItem("s_shrek","true"))})),Array.from(document.getElementsByClassName("dropdown"))[0].childNodes.forEach((function(e){e.addEventListener("click",(function(){Ke(e.getElementsByTagName("img")[0].getAttribute("alt")),document.getElementsByClassName("dropdown")[0].classList.remove("show"),document.getElementsByClassName("icon")[0].classList.remove("rotate")}))})),Ee?(null===localStorage.getItem("s_back_g_grid")?ne.checked=!0:ne.checked="on"===localStorage.getItem("s_back_g_grid"),null===localStorage.getItem("s_backg_image")?oe.checked=!0:oe.checked="on"===localStorage.getItem("s_backg_image"),null===localStorage.getItem("s_rotate")?ae.checked=!1:ae.checked="on"===localStorage.getItem("s_rotate"),null===localStorage.getItem("s_sound")?se.checked=!0:se.checked="on"===localStorage.getItem("s_sound"),null===localStorage.getItem("s_gold")?(re.checked=!1,Ye()):(re.checked="on"===localStorage.getItem("s_gold"),Ye()),null===localStorage.getItem("s_theme")?Ke("animals"):Ke(localStorage.getItem("s_theme"))):(ne.checked=!0,oe.checked=!0,ae.checked=!1,se.checked=!0,re.checked=!1,Ye(),Ke("animals")),("true"===(e=qe("mascha"))||Ee&&"true"===localStorage.getItem("s_mascha"))&&(Array.from(document.getElementsByClassName("t_mascha")).forEach((function(e){e.classList.remove("dn")})),Ee&&localStorage.setItem("s_mascha","true")),("true"===(e=qe("shrek"))||Ee&&"true"===localStorage.getItem("s_shrek"))&&(ee("t_shrek").parentNode.classList.remove("dn"),ee("favicon").href="Images/favicon_dark.ico",Ee&&localStorage.setItem("s_shrek","true")),(e=qe("theme"))&&Ke(e),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(ce.style.display="none",de.style.display="none"),ze(),setTimeout((function(){ze()}),500))},window.addEventListener("resize",(function(){ze()})),document.addEventListener("fullscreenchange",(function(){Se()})),document.addEventListener("mozfullscreenchange",(function(){Se()})),document.addEventListener("webkitfullscreenchange",(function(){Se()})),document.addEventListener("msfullscreenchange",(function(){Se()})),navigator.sayswho=(Ue=navigator.appName,je=navigator.userAgent,We=je.match(/version\/([.\d]+)/i),(Ze=je.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!==We&&(Ze[2]=We[1]),Ze=Ze?[Ze[1],Ze[2]]:[Ue,navigator.appVersion,"-?"]),document.webL10n.ready((function(){R=!0,(e=qe("lang"))&&e!==document.webL10n.getLanguage()&&(document.webL10n.setLanguage(e),R=!1)})),document.addEventListener("localized",(function(){R&&(document.documentElement.lang=document.webL10n.getLanguage().substr(0,2),document.querySelector("meta[name='description']").setAttribute("content",document.webL10n.get("lb_desc")),document.querySelector("link[rel='manifest']").href="Manifest/appmanifest_"+document.webL10n.getLanguage().substr(0,2)+".json",document.querySelector("link[rel='canonical']")&&(document.querySelector("link[rel='canonical']").href="https://grrd01.github.io/Puzzle/?lang="+document.webL10n.getLanguage().substr(0,2)),ee("select_theme").innerHTML=document.webL10n.get("lb_"+t),ee("imageOff").setAttribute("alt",document.webL10n.get("lb_image")),ee("image0-1").setAttribute("alt",document.webL10n.get("lb_image")),L||(we.src="Images/piece_gold.svg",_e.innerHTML=document.webL10n.get("lb_html5"),ke(Ie)),setTimeout((function(){new Date("05/01/2020")>new Date&&"africa"!==t&&Ee&&"africa"!==localStorage.getItem("s_new_theme")&&(we.src="Images/africa/theme.png",_e.innerHTML=document.webL10n.get("lb_new_theme")+" "+document.webL10n.get("lb_africa"),ke(Ie),localStorage.setItem("s_new_theme","africa"))}),500)),R=!0}))}();